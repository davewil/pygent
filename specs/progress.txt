2026-01-16: Initialized project structure and configuration.
2026-01-16: Implemented core tool system (ToolDefinition, tool decorator) and verified with tests.
2026-01-16: Configured pre-commit hooks for automatic linting (ruff) and testing (pytest).
2026-01-16: Repository initialized and pushed to GitHub (davewil/pygent).
2026-01-16: Implemented ToolRegistry class with property-based tests. Added hypothesis dependency.
2026-01-16: Implemented filesystem tools (read_file, list_files, edit_file) with unit tests.
2026-01-16: Refactored filesystem tools to use async I/O (aiofiles) and added property-based tests (hypothesis).
2026-01-16: Implemented Core Agent Infrastructure (LLMProvider, PermissionManager, Agent, Loop, Session Models) using TDD.
2026-01-16: Implemented Configuration System (settings.py, loader.py) with priority merging (Project > User > Defaults) and verified with tests.
2026-01-16: Implemented shell tool (src/pygent/tools/shell.py) with async execution, timeout handling, and output capturing.
2026-01-16: Added comprehensive unit and property-based tests for shell tool (tests/test_tools/test_shell.py).
2026-01-16: Implemented Session Storage (storage.py) with async I/O. Added SessionSummary model. Verified with unit and property-based tests.
2026-01-16: Implemented Basic TUI Structure (app.py, widgets.py, styles.tcss).
2026-01-16: Added TUI tests (test_app.py) verifying startup and key bindings.
2026-01-16: Integrated TUI with Agent Loop. Updated PygentApp to handle agent events and added integration tests (test_integration.py). Verified all tests pass.
2026-01-16: Implemented CLI entry point (src/pygent/cli.py) with chat command. Wired up to Agent/TUI. Verified with units tests.
2026-01-16: Implemented Permission Integration. Wired PermissionPrompt in TUI to Agent's PermissionManager via CLI. Added integration tests for Allow/Deny flows. Refactored CLI initialization to resolve circular dependencies.
2026-01-16: Implemented Session Persistence in TUI. Wired SessionStorage to PygentApp and implemented action_save_session method. Added verification tests.
2026-01-16: Added comprehensive tests for conversation loop error handling (test_loop.py): unknown tool handling, tool execution exceptions, permission denied flows, message conversion, multiple tool calls, and property-based tests. Also added LLMProvider tool call parsing tests for string/dict JSON args and invalid JSON handling. Coverage improved from 91% to 94%, with core/loop.py and core/providers.py now at 100%.
2026-01-16: Implemented CLI commands (sessions, resume, config). Sessions command lists saved sessions with ID, date, message count, and working directory. Resume command loads an existing session and starts the TUI. Config command displays current configuration. Fixed deprecated asyncio.get_event_loop() usage in property-based tests for Python 3.13 compatibility. Coverage improved to 95%.
2026-01-16: Added MockLLMProvider (core/mock_provider.py) for TUI testing without API key. Supports canned text responses and tool call triggers based on user input keywords. Added --mock flag to CLI chat command. Verified with unit tests.
2026-01-16: Added comprehensive error handling tests for SessionStorage (test_storage.py): corrupted file loading, non-existent session deletion, index.json skipping, and corrupted file filtering in list_sessions. Coverage for storage.py improved from 84% to 96%.
2026-01-16: Added shell tool exception path tests (test_shell.py): ProcessLookupError during timeout (when process exits before kill) and generic exception handling (when subprocess creation fails). Coverage for shell.py improved from 85% to 100%.
2026-01-16: Refactored CLI (src/pygent/cli.py) to consolidate initialization logic in _init_agent_and_app, reducing code duplication and ensuring consistent settings integration.
2026-01-16: Implemented missing TUI actions (PygentApp.action_new_session, PygentApp.action_toggle_permissions) and integrated TUI settings (theme, show_tool_panel).
2026-01-16: Added comprehensive integration tests for TUI actions (tests/test_integration/test_tui_actions.py) and fixed regressions in existing tests (test_cli.py, test_config.py, test_integration.py). Verified all 86 tests pass.
2026-01-16: Fixed case sensitivity in MockLLMProvider. Filenames now preserve original case for tool calls on Unix systems, while command triggers remains case-insensitive. Updated and added tests to verify fix.
2026-01-16: Finalized Phase 1 MVP. Implemented performance benchmarking (tests/test_performance.py) verifying <500ms tool execution. Achieved 96% test coverage across the codebase. Verified all CLI commands and TUI actions.
2026-01-16: Fixed GitHub Actions CI errors. Resolved ruff linting issues (import sorting) and fixed mypy source shadowing by configuring mypy_path = "src" in pyproject.toml. Handled version-specific mypy errors in loader.py using pragmas. Verified successful CI run across Python 3.10, 3.11, and 3.12.
2026-01-16: Improved test coverage from 96% to 97%. Added 13 new tests covering edge cases:
  - Fixed RuntimeWarnings in test_shell.py by replacing AsyncMock with MagicMock+explicit async methods to avoid unawaited coroutine warnings during pytest-asyncio/hypothesis cleanup
  - Added filterwarnings to pyproject.toml to suppress spurious AsyncMock cleanup warnings
  - MockLLMProvider tests: Added tests for delay feature, no-user-message edge case, quoted filename/path/command extraction, edit_file trigger, tool-result-only messages, and non-string content handling (87% → 97%)
  - Filesystem tests: Added tests for IsADirectoryError when reading directory, FileNotFoundError in list_files, and FileNotFoundError in edit_file (93% → 100%)
  - Total: 105 tests pass (up from 92), all linting/type checks pass.
2026-01-16: Started Phase 2 - Extended Tools. Implemented grep_search tool (src/pygent/tools/search.py):
  - Supports regex pattern matching in files with ripgrep backend (fast) or pure Python fallback
  - Features: file pattern filtering (glob), case-insensitive search, max results limit, context lines
  - Respects .gitignore-style exclusions (hidden dirs, node_modules, __pycache__, .git, venv)
  - Returns structured JSON results with file, line number, content, and match text
  - Added 22 tests including unit tests and property-based tests (hypothesis)
  - Total: 127 tests pass, 97% coverage maintained
2026-01-16: Implemented find_files tool (src/pygent/tools/search.py):
  - Finds files matching glob patterns (e.g., "**/*.py", "test_*.py")
  - Features: max_depth filtering, file_type filtering ("file" or "directory")
  - Respects .gitignore-style exclusions (hidden dirs, node_modules, __pycache__, .git, venv)
  - Returns sorted JSON results with relative paths
  - Added helper functions _should_include_path and _get_depth for cleaner logic
  - Added 20 tests: 13 unit tests + 4 helper function tests + 3 property-based tests (using uuid for isolation)
  - Learned: Hypothesis property-based tests with tmp_path fixture need unique subdirectories per example (uuid.uuid4()) to avoid state pollution
  - Total: 147 tests pass
2026-01-16: Implemented find_definition tool (src/pygent/tools/search.py):
  - Finds symbol definitions (functions, classes, interfaces, types, variables) in code
  - Multi-language support: Python, JavaScript, TypeScript, Go, Rust, Java, C, C++
  - Features: automatic language detection from file extensions, explicit language hint option
  - Uses regex patterns per language to match common definition styles:
    * Python: def, async def, class, variable assignment, typed variable
    * JavaScript: function, async function, class, const/let/var, exports
    * TypeScript: all JS patterns plus interface, type
    * Go: func, type struct/interface, var/const
    * Rust: fn, pub fn, async fn, struct, enum, trait, type alias, const/static/let
    * Java: public/private/protected methods, class, interface, enum
    * C/C++: functions, macros, typedefs, structs, enums, classes, namespaces
  - Added _DEFINITION_PATTERNS dict with language-specific regex templates
  - Added _EXTENSION_TO_LANGUAGE mapping for auto-detection
  - Added helper functions: _get_language_from_path, _compile_patterns_for_symbol
  - Symbols with regex special characters are escaped via re.escape()
  - Returns JSON with file, line number, definition type, and context
  - Added 27 tests: 21 unit tests + 6 helper function tests + 5 property-based tests
  - Learned: Pattern templates with {symbol} placeholder allow flexible pattern generation
  - Learned: Breaking pattern match on first match per line prevents duplicate reports
  - Search Tools section of Phase 2 now complete (grep_search, find_files, find_definition)
  - Total: 179 tests pass
2026-01-17: Implemented Additional File Tools (src/pygent/tools/filesystem.py):
  - create_file: Creates new file with content, auto-creates parent directories via Path.mkdir(parents=True)
    * Raises FileExistsError if file already exists (intentional, prevents accidental overwrites)
    * Risk level: MEDIUM
  - delete_file: Deletes a single file (HIGH risk)
    * Uses asyncio.to_thread(path.unlink) for non-blocking deletion
    * Raises IsADirectoryError if path is directory (use shell for rmdir)
    * Raises FileNotFoundError if file doesn't exist
  - move_file: Moves or renames a file (MEDIUM risk)
    * Uses shutil.move wrapped in asyncio.to_thread for async operation
    * Auto-creates parent directories for destination
    * Raises FileExistsError if destination exists (prevents accidental overwrites)
  - copy_file: Copies a file to new location (MEDIUM risk)
    * Uses shutil.copy2 (preserves metadata: timestamps, permissions)
    * Auto-creates parent directories for destination
    * Raises FileExistsError if destination exists
  - Added 18 unit tests covering: basic operations, nested paths, error cases (not found, is directory, already exists)
  - Added 4 property-based tests using hypothesis: create/delete/move/copy roundtrip verification
  - Learned: Use uuid.uuid4() subdirectories in property tests to avoid state pollution between examples
  - Learned: shutil.copy2 preserves metadata unlike shutil.copy; use asyncio.to_thread to wrap blocking shutil calls
  - Additional File Tools section of Phase 2 now complete
  - Total: 201 tests pass
2026-01-17: Implemented Git Tools (src/pygent/tools/git.py):
  - git_status: Shows working tree status (staged/unstaged/untracked files, current branch)
  - git_diff: Unified diff output with --cached, commit, and path filter support
  - git_log: Commit history with count limit, oneline format, and path filter
  - git_branch: List/create/delete branches, includes --all for remote branches
  - git_add: Stage files for commit (MEDIUM risk)
  - git_commit: Create commit with message (MEDIUM risk)
  - git_checkout: Switch branches (-b for create), restore files from HEAD (MEDIUM risk)
  - git_push: Push to remote with -u set-upstream support (HIGH risk)
  - git_pull: Fetch and integrate from remote (MEDIUM risk)
  - Helper functions: _run_git_command (async subprocess), _check_git_repo (validates git repo)
  - GitError exception class for graceful failure outside git repositories
  - All tools use asyncio.create_subprocess_exec for non-blocking git operations
  - Added 50 tests: 42 unit tests + 4 property-based tests + 1 integration test (full workflow)
  - Learned: Git commands often output to stderr even on success (e.g., checkout, push), so check both stdout and stderr
  - Learned: Use MagicMock with patch for testing remote operations (push/pull) since no real remote exists
  - Learned: Property tests with hypothesis need careful strategy selection - st.from_regex is cleaner than filter()
  - Git Tools section of Phase 2 now complete
  - Total: 251 tests pass
2026-01-17: Implemented Web Tools (src/pygent/tools/web.py):
  - web_fetch: Fetches URL content with httpx async client
    * HTTPS enforced (HTTP URLs automatically upgraded)
    * Configurable timeout (default 30s) and max_size (default 1MB)
    * Content type handling: JSON pretty-printing, HTML to text conversion, plain text passthrough
    * Follows redirects automatically (httpx follow_redirects=True)
    * Returns JSON with status_code, content_type, url (final), and content
    * Truncation indicator when content exceeds max_size
  - WebFetchError exception class for graceful error handling
  - _HTMLToTextParser: Simple HTML to text converter using html.parser
    * Strips script, style, noscript, head, meta, link tags
    * Handles common elements: p, div, h1-h6, ul, ol, li, br, hr, pre, a
    * Normalizes whitespace for non-preformatted text
  - Helper functions: _upgrade_to_https, _html_to_text, _format_response
  - Added 45 tests: 30 unit tests + 5 property-based tests covering:
    * URL validation (HTTPS enforcement, HTTP upgrade)
    * Content type handling (JSON, HTML, plain text)
    * Size limit enforcement
    * Error handling (timeout, connect error, HTTP status error, request error)
    * Custom headers, various HTTP methods
  - Learned: latin-1 encoding can decode any byte sequence (0x00-0xFF), so fallback after latin-1 is unreachable
  - Learned: HTMLParser is robust and rarely throws exceptions, making exception fallback hard to test
  - Learned: httpx.AsyncClient context manager pattern with patch requires mocking __aenter__ and __aexit__
  - Web Tools section of Phase 2 now complete
  - Total: 296 tests pass, 96% overall coverage, web.py at 97% coverage
2026-01-17: Implemented Tool Categories & Discovery (Phase 2 Complete):
  - Added ToolCategory enum to tools/base.py: FILESYSTEM, GIT, SEARCH, WEB, SHELL
  - Updated ToolDefinition dataclass to include category field
  - Updated @tool decorator to accept category parameter (default: SHELL)
  - Added categories to all existing tools:
    * FILESYSTEM: read_file, list_files, edit_file, create_file, delete_file, move_file, copy_file
    * GIT: git_status, git_diff, git_log, git_branch, git_add, git_commit, git_checkout, git_push, git_pull
    * SEARCH: grep_search, find_files, find_definition
    * SHELL: shell
    * WEB: web_fetch
  - Updated ToolRegistry with new methods:
    * list_all(): Returns all registered tools
    * list_by_category(category): Returns tools in a specific category
    * get_categories(): Returns sorted list of categories with registered tools
  - Added CLI 'tools' command (pygent tools):
    * Lists all tools grouped by category
    * Supports --category/-c filter option
    * Shows risk level indicators [LOW], [MEDIUM], [HIGH]
  - Added _create_full_registry() helper in cli.py to register all tools
  - Added 17 new tests:
    * ToolCategory enum tests (values, from_string, invalid)
    * @tool decorator category tests (explicit and default)
    * ToolRegistry category method tests (list_all, list_by_category, get_categories)
    * CLI tools command tests (list all, filter by category, invalid category, risk levels)
  - Learned: Adding a new field to dataclass requires updating all existing instantiations in tests
  - Learned: str Enum provides automatic string conversion and validation
  - Learned: CLI commands can use raise ... from None to suppress exception chaining
  - Tool Categories & Discovery section of Phase 2 now complete
  - Phase 2 all acceptance criteria now met
  - Total: 313 tests pass
2026-01-17: Started Phase 3 - Advanced Features. Implemented Context Awareness System (src/pygent/context/):
  - Created context module structure (__init__.py, models.py, detection.py, prompt.py)
  - Implemented TestFramework enum: pytest, unittest, jest, mocha, vitest, go test, cargo test
  - Implemented ProjectType enum: python, node, go, rust, unknown
  - Implemented GitInfo model: branch, remote, has_changes, commit_count, last_commit
  - Implemented ProjectContext model: type, root, name, version, dependencies, scripts, test_framework, git_info, config_files
  - Implemented detect_project_context() function:
    * Auto-detects project type from config files (pyproject.toml, package.json, go.mod, Cargo.toml)
    * Parses dependencies and scripts from project files
    * Detects test framework from config and dependencies
    * Gathers git repository info (branch, status, commit count)
    * Python detection takes precedence over other types when multiple markers present
  - Implemented GitIgnoreFilter class:
    * Default excludes: .git, __pycache__, node_modules, venv, dist, build, etc.
    * Loads patterns from .gitignore file
    * Handles directory patterns (ending with /)
    * filter_paths() method for batch filtering
  - Implemented build_system_prompt() function:
    * Injects project context into base system prompt
    * Formats dependencies, scripts, test framework, git info
    * Adds language-specific coding conventions (PEP 8 for Python, gofmt for Go, etc.)
    * Supports user customization overrides
  - Added 92 tests (unit + property-based):
    * test_models.py: 16 tests for enums, GitInfo, ProjectContext serialization
    * test_detection.py: 44 tests for GitIgnoreFilter, detect functions, git info
    * test_prompt.py: 32 tests for formatting helpers and build_system_prompt
  - Learned: Use sys.version_info >= (3, 11) for tomllib import (cleaner than try/except for mypy)
  - Learned: Add __test__ = False to Enum classes with "Test" in name to prevent pytest collection
  - Learned: fnmatch doesn't handle gitignore directory patterns (ending with /); need special handling
  - Learned: Pydantic models with nested optional models (like GitInfo) serialize/deserialize cleanly
  - Context Awareness section of Phase 3 now complete
  - Total: 405 tests pass
2026-01-17: Implemented Test Runner Integration (src/pygent/tools/testing.py):
  - Added TESTING category to ToolCategory enum in tools/base.py
  - Implemented TestResult dataclass: name, status (passed/failed/skipped/error), duration, error_message, file_path, line_number
  - Implemented TestSummary dataclass: total, passed, failed, skipped, errors, duration, results list, raw_output
  - Implemented detect_test_framework() function:
    * Auto-detects from config files: pyproject.toml, pytest.ini, setup.cfg, package.json, go.mod, Cargo.toml
    * Falls back to checking for test_*.py files in tests/ or root directory
    * Returns TestFramework enum (reused from context/models.py)
  - Implemented output parsers for each framework:
    * _parse_pytest_output: Parses verbose test results and summary line ("X passed, Y failed in Z.XXs")
    * _parse_jest_output: Parses ✓/✕/○ markers and "Tests: X passed, Y failed" summary
    * _parse_go_test_output: Parses "--- PASS/FAIL/SKIP:" lines and "ok/FAIL package" summary
    * _parse_cargo_test_output: Parses "test ... ok/FAILED/ignored" and "test result:" summary
    * _parse_unittest_output: Parses verbose output and "Ran X tests in Y.YYYs" summary
  - Implemented _build_test_command() helper:
    * Builds framework-specific command line with options (verbose, coverage, fail_fast, pattern, path)
    * Supports: pytest, unittest, jest, vitest, go test, cargo test, mocha
  - Implemented _format_summary() for human-readable output
  - Implemented run_tests tool:
    * Auto-detects or accepts explicit framework
    * Supports: path, pattern, verbose, coverage, fail_fast, timeout options
    * Uses asyncio.create_subprocess_exec for non-blocking execution
    * Returns formatted summary with failed test details
    * Risk level: MEDIUM, Category: TESTING
  - Registered run_tests tool in cli.py _create_full_registry()
  - Added 72 tests:
    * TestResult/TestSummary model tests
    * Framework detection tests (pytest, jest, vitest, mocha, go, cargo, unknown)
    * Output parser tests for each framework (passed, failed, skipped scenarios)
    * parse_test_output dispatcher tests
    * _build_test_command tests for each framework with options
    * _format_summary tests
    * run_tests tool tests (success, failure, timeout, not found, error paths)
    * Property-based tests with hypothesis
    * Integration tests
  - Learned: Pytest summary line format varies - counts can appear in any order, so use individual regex patterns
  - Learned: Add __test__ = False to dataclasses with "Test" in name to prevent pytest collection
  - Learned: Test frameworks often output to stderr (warnings), so combine stdout/stderr for complete results
  - Learned: Use MagicMock with explicit async methods to avoid RuntimeWarning for unawaited coroutines
  - Test Runner section of Phase 3 now complete (framework detection, run_tests tool, output parsing)
  - Total: 477 tests pass
2026-01-17: Implemented Project Scaffolding System (src/pygent/tools/scaffold.py):
  - Added PROJECT category to ToolCategory enum in tools/base.py
  - Implemented data models:
    * TemplateOption: Configuration options (bool, str, choice types)
    * TemplateFile: File templates with path, content, and optional condition
    * ProjectTemplate: Complete project templates with files, options, post-create commands, next steps
    * ComponentTemplate: Components that can be added to existing projects
  - Implemented 3 built-in project templates:
    * python-cli: Python CLI application with Click (or Typer via use_typer option)
      - Full pyproject.toml with setuptools, pytest, ruff, mypy configuration
      - src/{name}/ structure with cli.py, main.py, __init__.py
      - tests/ with conftest.py and test_main.py
      - Optional Dockerfile via include_docker option
    * python-lib: Python library for PyPI distribution
      - Minimal structure focused on library distribution
      - Includes classifiers, URLs, example docstrings
    * fastapi: FastAPI web application
      - Full project structure: api/, core/, tests/
      - routes.py, schemas.py, config.py with pydantic-settings
      - Health check endpoint, example greet endpoint
  - Implemented 5 built-in component templates:
    * model: Data model class with dataclass
    * service: Service class with CRUD-like methods
    * test: Test file skeleton
    * cli_command: Click command (for python-cli projects)
    * route: FastAPI router (for fastapi projects)
  - Implemented 4 tools:
    * list_templates: Returns JSON array of available templates with options (LOW risk)
    * create_project: Creates project from template with options (MEDIUM risk)
    * list_components: Returns JSON array of available components (LOW risk)
    * add_component: Adds component to existing project (MEDIUM risk)
  - Implemented helper functions:
    * _normalize_project_name: Converts name to valid Python identifier (hyphens→underscores, lowercase, remove invalid chars)
    * _to_class_name: Converts to PascalCase for class names
    * _evaluate_condition: Evaluates template conditions ("use_typer", "not include_docker")
    * _render_template: Replaces {placeholders}, handles {{escaped}} braces
    * _detect_project_name: Detects project name from pyproject.toml or directory
    * _create_file: Creates file with parent directories
  - Template rendering features:
    * {name} placeholders replaced with project name
    * {{double_braces}} become {single_braces} for Python f-strings
    * Conditional files via condition field
    * Default option values applied automatically
  - Registered all tools in cli.py _create_full_registry()
  - Added 77 tests:
    * Helper function tests (normalize, class_name, condition, render, detect)
    * Data model tests (TemplateOption, TemplateFile, ProjectTemplate, ComponentTemplate)
    * Built-in template/component structure tests
    * list_templates/list_components tool tests
    * create_project tests (python-cli, python-lib, fastapi, options, errors)
    * add_component tests (model, service, test, errors, existing files)
    * Property-based tests (name normalization, template rendering, all templates)
    * Integration tests (full workflow, list-then-create)
    * Edge cases (deep paths, unicode, numbers)
  - Learned: Template strings with f-string braces need {{double_braces}} to escape, then rendered back to single braces
  - Learned: Use placeholder substitution before restoring escaped braces to avoid conflicts
  - Learned: Property tests for create_project need uuid subdirectories to isolate examples
  - Learned: Component templates need project type context to generate correct paths
  - Project Scaffolding section of Phase 3 now complete
  - Total: 554 tests pass
2026-01-17: Implemented Error Recovery System (src/pygent/core/recovery.py):
  - Added ErrorType enum with 15 error classifications:
    * FILE_NOT_FOUND, PERMISSION_DENIED, IS_A_DIRECTORY, FILE_EXISTS, NOT_A_DIRECTORY
    * GIT_NOT_A_REPOSITORY, GIT_CONFLICT, GIT_NO_REMOTE
    * MODULE_NOT_FOUND, TIMEOUT, CONNECTION_ERROR
    * SYNTAX_ERROR, JSON_DECODE_ERROR, INVALID_ARGUMENT, UNKNOWN
  - Implemented RecoveryAction dataclass:
    * error_type: Classified error type
    * should_retry: Whether tool should be retried
    * suggestions: List of actionable suggestions
    * modified_args: Optional modified arguments for retry
    * similar_paths: Similar paths found (for file errors)
  - Implemented ERROR_PATTERNS dictionary for exception class matching:
    * Maps exception class names to error types and suggestions
    * Includes patterns for FileNotFoundError, PermissionError, TimeoutError, etc.
    * Supports httpx exceptions (ConnectError, TimeoutException)
    * Includes auto_retry flag for retryable errors (Timeout, Connection)
  - Implemented MESSAGE_PATTERNS list for error message regex matching:
    * Catches errors that don't match by exception class
    * Extracts module names from "No module named" messages
    * Detects git repository issues, connection errors, timeouts
  - Implemented ErrorRecovery class:
    * handle_tool_error(): Analyzes exceptions and returns RecoveryAction
    * _resolve_exception_class(): Resolves exception classes from strings (handles dotted names)
    * _contextualize_suggestions(): Adds context-specific information to suggestions
    * add_error_pattern(): Register custom exception patterns
    * add_message_pattern(): Register custom message regex patterns
  - Priority matching: Exception class > Parent classes > Message patterns > Unknown
  - Added 43 tests:
    * TestErrorType: 3 tests for enum values and structure
    * TestRecoveryAction: 4 tests for dataclass defaults and fields
    * TestErrorPatterns: 6 tests for ERROR_PATTERNS structure and content
    * TestMessagePatterns: 4 tests for MESSAGE_PATTERNS structure
    * TestErrorRecovery: 14 tests for handle_tool_error with various exceptions
    * TestErrorRecoveryCustomPatterns: 3 tests for custom pattern registration
    * TestContextualization: 2 tests for suggestion contextualization
    * TestPropertyBased: 3 property-based tests using hypothesis
    * TestIntegration: 4 integration tests for real tool error scenarios
  - Learned: In Python 3.11+, str(StrEnum.VALUE) returns "EnumName.VALUE", use .value for the string
  - Learned: hypothesis st.characters() requires valid Unicode categories, not arbitrary characters
  - Learned: __builtins__ can be a dict or module depending on context, need to handle both
  - Learned: Use vars(__builtins__) to convert module to dict for consistent access
  - Error Recovery section of Phase 3 now complete
  - Total: 597 tests pass
2026-01-17: Implemented Tool Result Caching (src/pygent/core/cache.py):
  - Added ToolCache class with LRU eviction and TTL-based expiration
  - CacheEntry dataclass stores: value, expires_at, tool_name, args_hash
  - CacheStats dataclass tracks: hits, misses, evictions, invalidations
  - NON_CACHEABLE_TOOLS frozenset identifies mutation tools (edit_file, shell, git_commit, etc.)
  - DEFAULT_TOOL_TTL dictionary sets per-tool TTL (git_status: 5s, grep_search: 30s, web_fetch: 60s)
  - Cache key generation: SHA256 hash of JSON-serialized sorted args
  - LRU eviction using OrderedDict with move_to_end on access
  - Pattern-based invalidation with fnmatch (e.g., "read_file:*")
  - Methods: get, set, invalidate, invalidate_tool, clear, cleanup_expired, get_stats, reset_stats
  - Integrated into conversation_loop (loop.py):
    * Checks cache before tool execution
    * Stores results after successful execution
    * LoopEvent gains cached=True flag for cache hits
  - Added tool_cache parameter to Agent.__init__ (defaults to new ToolCache)
  - Added 48 tests:
    * TestCacheEntry: 2 tests for dataclass creation/expiration
    * TestCacheStats: 2 tests for defaults and incrementing
    * TestNonCacheableTools: 4 tests for mutation tool categorization
    * TestDefaultToolTTL: 3 tests for TTL configuration
    * TestToolCache: 15 tests for set/get, expiration, LRU eviction, stats
    * TestToolCacheInvalidation: 5 tests for pattern invalidation, clear, cleanup
    * TestToolCacheKeyGeneration: 4 tests for deterministic key generation
    * TestToolCacheTTL: 4 tests for TTL handling
    * TestToolCacheConcurrency: 3 tests for concurrent access with asyncio.Lock
    * TestPropertyBased: 4 property-based tests using hypothesis
    * TestIntegration: 5 integration tests for realistic scenarios
  - Learned: OrderedDict.move_to_end(key) is efficient O(1) for LRU implementation
  - Learned: asyncio.Lock for async-safe cache operations (not threading.Lock)
  - Learned: JSON serialization with sort_keys=True ensures deterministic cache keys
  - Learned: fnmatch provides simple glob-style pattern matching for invalidation
  - Learned: dict[str, int | float] union type needed when return value includes both types
  - Tool Caching section of Phase 3 now complete
  - Total: 645 tests pass
2026-01-17: Implemented Parallel Tool Execution (src/pygent/core/parallel.py):
  - Added READ_ONLY_TOOLS frozenset identifying safe-for-parallel tools:
    * Filesystem reads: read_file, list_files
    * Search operations: grep_search, find_files, find_definition
    * Git reads: git_status, git_diff, git_log, git_branch
    * Web: web_fetch (no local side effects)
    * Listing: list_templates, list_components
  - Added PATH_ARGUMENTS frozenset for conflict detection (path, file_path, source, destination, etc.)
  - Implemented data models:
    * ToolExecution: Wraps tool_use + tool_def with is_read_only and affected_paths metadata
    * ToolResult: Execution result with tool_use_id, result, is_error, was_cached flags
    * ExecutionBatch: Groups executions with can_parallelize flag
  - Implemented helper functions:
    * is_read_only_tool(): Checks if tool is safe for parallel execution
    * extract_affected_paths(): Extracts file paths from tool arguments
    * paths_conflict(): Detects overlap or parent-child relationships between path sets
    * prepare_tool_execution(): Prepares tool use with metadata
    * group_into_batches(): Groups tools into parallel/sequential batches
  - Implemented execution functions:
    * execute_single_tool(): Executes one tool with permission checking and caching
    * execute_batch(): Executes batch with asyncio.gather for parallel, sequential for writes
    * execute_tools_parallel(): Main entry point - groups and executes tool calls
    * get_parallel_stats(): Returns parallelization statistics
  - Safety rules enforced:
    * Read operations can run in parallel with each other
    * Write operations always run sequentially
    * Operations affecting same paths (including parent-child) run sequentially
  - Updated conversation_loop (loop.py):
    * Replaced sequential tool execution with execute_tools_parallel()
    * Maintains result ordering for LLM response
    * Preserves permission_denied event handling
  - Added 58 tests:
    * TestReadOnlyTools: 4 tests for READ_ONLY_TOOLS constant
    * TestPathArguments: 1 test for PATH_ARGUMENTS constant
    * TestIsReadOnlyTool: 4 tests for tool classification
    * TestExtractAffectedPaths: 6 tests for path extraction
    * TestPathsConflict: 7 tests for conflict detection
    * TestToolExecution: 1 test for dataclass creation
    * TestToolResult: 3 tests for result dataclass
    * TestExecutionBatch: 2 tests for batch creation
    * TestPrepareToolExecution: 2 tests for preparation
    * TestGroupIntoBatches: 6 tests for batching logic
    * TestExecuteSingleTool: 4 async tests for single execution
    * TestExecuteBatch: 2 async tests for batch execution
    * TestExecuteToolsParallel: 5 async tests for parallel execution
    * TestGetParallelStats: 3 tests for statistics
    * TestPropertyBased: 4 property-based tests using hypothesis
    * TestIntegration: 4 async integration tests (timing verification, permission denied)
  - Learned: asyncio.gather() preserves order of results matching input order
  - Learned: Path conflict detection needs to handle trailing slashes
  - Learned: Parent-child path relationships need startswith() with "/" suffix check
  - Learned: Factory pattern needed for capturing loop variables in async closures
  - Learned: Return type Any for mock factory functions avoids mypy type mismatch errors in tests
  - Parallel Tool Execution section of Phase 3 now complete
  - Total: 703 tests pass
2026-01-17: Implemented Session Sidebar (src/pygent/tui/widgets.py, app.py):
  - Added SessionItem widget: Displays individual session with truncated ID, message count, active indicator
    * Supports is_active flag with CSS class "session-active" for highlighting
    * Display format: "▸ abcdefgh… (5 msgs)" for active, "  abcdefgh… (5 msgs)" for inactive
  - Added SessionsSidebar widget: Collapsible sidebar showing saved sessions
    * Features: List sessions, highlight active session, click to switch (planned)
    * Methods: add_session(), update_active_session(), clear(), get_session_count()
    * Uses VerticalScroll for long session lists
  - Added show_sidebar setting to TUISettings (default: True)
  - Integrated into PygentApp:
    * Sidebar appears on left side of layout (before ConversationPanel)
    * Populated from SessionStorage on mount with current session highlighted
    * Updates when new session is created (ctrl+n)
  - Added ctrl+b keybinding to toggle sidebar visibility
    * Uses widget.display property for showing/hiding
    * Graceful handling when sidebar not present in settings
  - Added CSS styling (styles.tcss):
    * Fixed width (24 chars), accent-colored border
    * Hover effect for session items
    * Active session highlighted with primary color and bold text
  - Learned: Textual CSS doesn't support "cursor: pointer" property
  - Learned: DOM manipulation in Textual is asynchronous - need await pilot.pause() after remove() calls in tests
  - Learned: Use query(WidgetClass).remove() pattern for clearing specific widget types
  - Learned: When updating active session, check if session exists first to avoid deactivating all items
  - Added 28 tests:
    * TestSessionItem: 4 tests for widget creation and properties
    * TestSessionsSidebar: 7 tests for sidebar methods (compose, add, update_active, clear, count)
    * TestPygentAppSidebarIntegration: 6 tests for app integration (default, disabled, toggle, keybinding)
    * TestSidebarWithStorage: 3 tests for storage integration (populate, highlight, no storage)
    * TestPropertyBased: 4 property-based tests using hypothesis
    * TestEdgeCases: 4 edge case tests (empty ID, long ID, special chars, nonexistent session)
  - Session Sidebar section of Phase 3 now complete
  - Total: 731 tests pass
2026-01-17: Implemented Command Palette (src/pygent/tui/widgets.py, app.py, styles.tcss):
  - Added PaletteCommand dataclass: Represents a command with id, name, description, and optional shortcut
    * matches() method for fuzzy search: substring matching and character-in-order matching
  - Added _fuzzy_match() helper: Checks if all characters in query appear in text in order
  - Added DEFAULT_COMMANDS list with 7 built-in commands:
    * new_session, save_session, toggle_sidebar, toggle_permissions, toggle_tools, clear, quit
  - Added CommandPaletteItem widget: Displays single command with selection state
    * set_selected() method to toggle visual selection
    * CSS classes: palette-item, palette-item-selected
  - Added CommandPalette ModalScreen: Main command palette UI
    * Fuzzy search input field at top
    * Scrollable list of filtered commands
    * Keyboard navigation: up/down arrows, enter to select, escape to dismiss
    * Custom commands support via constructor parameter
    * _update_command_list() filters and rebuilds command list on input change
    * on_input_submitted() handler to execute command when Enter pressed in input field
  - Integrated into PygentApp:
    * Added ctrl+shift+p keybinding to open command palette
    * action_command_palette() uses push_screen with callback pattern (not push_screen_wait)
    * callback uses call_later() to execute actions outside of the callback context
  - Added new TUI actions:
    * action_toggle_tools(): Toggle tool panel visibility (ctrl+t)
    * action_clear(): Clear conversation and tool panel (ctrl+l)
  - Added CSS styling for command palette:
    * Centered modal with fixed width (60 chars)
    * Input field with accent border
    * Command list with hover and selected states
  - Learned: When Input widget has focus, Enter triggers Input.Submitted event, not screen keybinding
    * Must handle on_input_submitted() to capture Enter key in command palette
  - Learned: push_screen_wait() requires being in a worker context; use callback pattern instead for actions
  - Learned: To query a modal screen in tests, use app.screen instead of app.query_one()
  - Learned: Callbacks from push_screen need asyncio.sleep() in tests to allow execution time
  - Learned: Use call_later() in callbacks to defer action execution outside callback context
  - Added 53 tests:
    * TestPaletteCommand: 8 tests for dataclass and matching
    * TestFuzzyMatch: 7 tests for fuzzy matching helper
    * TestDefaultCommands: 4 tests for default commands list
    * TestCommandPaletteItem: 6 tests for item widget
    * TestCommandPalette: 11 tests for palette widget (compose, filter, dismiss, navigation)
    * TestPygentAppCommandPaletteIntegration: 3 tests for app integration
    * TestNewActions: 4 tests for toggle_tools and clear actions
    * TestPropertyBased: 5 property-based tests using hypothesis
    * TestEdgeCases: 5 edge case tests (empty commands, special chars, unicode, rapid filter)
  - Command Palette section of Phase 3 now complete
  - Total: 784 tests pass
2026-01-17: Implemented Tool Execution Progress (src/pygent/tui/widgets.py, core/loop.py, app.py, styles.tcss):
  - Added timestamp field to LoopEvent dataclass for tracking execution timing
  - Added ToolStatus enum with states: WAITING, RUNNING, COMPLETED, ERROR, CACHED, PERMISSION_DENIED
  - Added STATUS_ICONS dict mapping each status to a visual indicator emoji
  - Added _format_elapsed_time() helper to format duration as human-readable (e.g., "1.2s", "5m 30.0s")
  - Implemented ToolProgressItem widget:
    * Tracks tool_id, tool_name, status, start_time, end_time, result, is_error
    * Shows status icon, tool name, elapsed time, and result preview
    * update_status() method for in-place updates when results arrive
    * refresh_elapsed_time() method for periodic timer updates while running
    * CSS classes: tool-progress, tool-progress-{status} for styling each state
    * Truncates long results to 100 chars with "..." suffix
    * Replaces newlines with spaces in display text
  - Updated ToolPanel to track progress items by tool_id:
    * _progress_items dict maps tool_id to ToolProgressItem for in-place updates
    * append_tool_call() creates new ToolProgressItem with RUNNING status
    * update_tool_result() finds existing item by tool_id and updates status
    * update_permission_denied() sets PERMISSION_DENIED status
    * get_running_count() returns number of currently running tools
    * refresh_running_tools() updates elapsed time display for all running tools
    * Legacy append_tool_result() maintained for backwards compatibility
    * clear() now also clears the _progress_items tracking dict
  - Updated conversation_loop to emit timestamps and tool_id in events:
    * tool_call events include timestamp for accurate elapsed time
    * tool_result events include tool_id for matching to progress items
    * permission_denied events include tool_id for proper tracking
  - Updated PygentApp.run_agent_loop() to use new ToolPanel methods:
    * Passes start_time from event.timestamp to append_tool_call()
    * Calls update_tool_result() with tool_id, result, is_error, cached
    * Calls update_permission_denied() for permission_denied events
  - Added CSS styling for tool progress states:
    * tool-progress-waiting: muted background for queued tools
    * tool-progress-running: warning color (yellow) for executing tools
    * tool-progress-completed: success color (green) for successful tools
    * tool-progress-error: error color (red) for failed tools
    * tool-progress-cached: accent color for cached results
    * tool-progress-permission_denied: error highlight for denied tools
  - Updated tests to use ToolProgressItem instead of legacy ToolResultItem
  - Learned: When widgets update in-place, need to match tool_id between call and result events
  - Learned: datetime timestamps are useful for accurate elapsed time calculation
  - Learned: CSS class naming with status.value provides clean status-based styling
  - Learned: Legacy method wrappers maintain backwards compatibility for existing tests
  - Learned: Result preview truncation with newline replacement improves display readability
  - Added 56 tests:
    * TestToolStatus: 2 tests for enum values and icons
    * TestStatusIcons: 2 tests for icon mapping
    * TestFormatElapsedTime: 6 tests for time formatting
    * TestToolProgressItem: 5 tests for widget creation and properties
    * TestToolProgressItemUpdateStatus: 5 tests for status updates
    * TestToolProgressItemRefresh: 2 tests for elapsed time refresh
    * TestToolProgressItemBuildDisplayText: 5 tests for display formatting
    * TestToolPanel: 13 tests for panel operations
    * TestToolPanelLegacyMethod: 1 test for backwards compatibility
    * TestLoopEventTimestamp: 3 tests for event timestamp field
    * TestToolProgressIntegration: 1 integration test
    * TestPropertyBased: 5 property-based tests using hypothesis
    * TestEdgeCases: 6 edge case tests
  - Tool Execution Progress section of Phase 3 now complete
  - TUI remains responsive during long operations acceptance criterion now met
  - Total: 840 tests pass
2026-01-17: Started Phase 4 - Polish & Distribution. Implemented System Prompt Customization (src/pygent/config/):
  - Enhanced SystemPromptSettings model (settings.py):
    * Added content: str | None - direct prompt content
    * Added file: str | None - path to prompt file (supports ~ expansion)
    * Added append: str | None - additional content to append
    * Added mode: Literal["replace", "append"] - how to combine with base
    * Created DEFAULT_SYSTEM_PROMPT constant with helpful base prompt
  - Created prompt.py module for prompt loading and template variables:
    * TEMPLATE_VARIABLES dict defining available variables: project_name, project_type, current_dir, git_branch, date, os
    * PromptLoadError exception for file loading failures
    * get_template_variables() - resolves variables from ProjectContext or defaults
    * resolve_template_variables() - replaces {variable} placeholders in content
    * load_prompt_file() - loads prompt from file with ~ expansion
    * get_effective_prompt() - applies all settings (file, content, mode, append) and resolves variables
    * build_full_system_prompt() - combines user settings with project context injection
  - Updated config/__init__.py to export new prompt module functions
  - Wired system prompt into Agent/Provider:
    * Added system_prompt parameter to Agent.__init__
    * Added system_prompt parameter to conversation_loop()
    * System message injected as first message with role="system" in LLM calls
    * CLI (_init_agent_and_app) builds system prompt from settings + detected project context
  - Added 50 comprehensive tests (test_config_prompt.py):
    * TestTemplateVariables: 2 tests for TEMPLATE_VARIABLES constant
    * TestGetTemplateVariables: 6 tests for variable resolution
    * TestResolveTemplateVariables: 6 tests for template substitution
    * TestLoadPromptFile: 6 tests for file loading
    * TestGetEffectivePrompt: 12 tests for settings application
    * TestBuildFullSystemPrompt: 4 tests for full prompt building
    * TestPropertyBased: 4 property-based tests using hypothesis
    * TestEdgeCases: 6 edge case tests (empty, whitespace, newlines, nested braces)
    * TestDefaultSystemPrompt: 3 tests for default prompt constant
    * TestIntegration: 2 end-to-end tests
  - Learned: Template variable resolution should preserve unknown {variables} rather than raising errors
  - Learned: file parameter takes precedence over content when both are specified
  - Learned: System prompt must be injected at conversation_loop level, not provider level, for proper message ordering
  - Learned: Use Path.expanduser() for ~ expansion in file paths
  - Learned: Pydantic Literal type provides built-in validation for mode parameter
  - System Prompt Customization section of Phase 4 now complete (user/project config, template variables, context injection)
  - CLI prompt commands (show, set, edit, reset) deferred to future work
  - Total: 890 tests pass
2026-01-18: Implemented Environment Variable Support for Configuration (src/pygent/config/loader.py):
  - Added ENV_MAPPINGS constant mapping env vars to config paths:
    * PYGENT_MODEL -> llm.model
    * PYGENT_API_KEY -> llm.api_key
    * PYGENT_MAX_TOKENS -> llm.max_tokens
    * PYGENT_PROVIDER -> llm.provider
    * ANTHROPIC_API_KEY -> llm.api_key (fallback)
    * OPENAI_API_KEY -> llm.api_key (fallback)
  - Added API_KEY_ENV_PRIORITY list for API key precedence: PYGENT_API_KEY > ANTHROPIC_API_KEY > OPENAI_API_KEY
  - Implemented helper functions:
    * _set_nested_value() - sets value in nested dict using dotted path like "llm.model"
    * _convert_env_value() - converts env strings to appropriate types (int for max_tokens, bool for flags)
    * _load_env_config() - loads all configured env vars into a dict
  - Updated load_config() with new priority order: env vars > project config > user config > defaults
    * Added load_env parameter (default True) to optionally skip env var loading
  - Exported ENV_MAPPINGS and API_KEY_ENV_PRIORITY from config module
  - Added 37 comprehensive tests (test_config_env.py):
    * TestEnvMappings: 3 tests for ENV_MAPPINGS constant
    * TestApiKeyEnvPriority: 3 tests for API key priority
    * TestSetNestedValue: 6 tests for nested value setting
    * TestConvertEnvValue: 6 tests for type conversion
    * TestLoadEnvConfig: 7 tests for env config loading
    * TestLoadConfigWithEnv: 4 async tests for integrated loading
    * TestPropertyBased: 3 property-based tests using hypothesis
    * TestEdgeCases: 4 edge case tests (empty vars, whitespace, special chars)
    * TestIntegration: 1 integration test for realistic usage
  - Learned: API key env vars need priority ordering since multiple can be set
  - Learned: Empty strings are falsy in Python, so empty env vars are effectively unset
  - Learned: Boolean conversion should support multiple true-like values: "true", "1", "yes", "on"
  - Learned: monkeypatch.delenv() with raising=False is cleaner for clearing env vars in tests
  - Configuration Polish: Environment Variables section of Phase 4 now complete
  - Total: 927 tests pass
